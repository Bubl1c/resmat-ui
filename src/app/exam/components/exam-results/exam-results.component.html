<div class="results-container">
  <div class="mui-panel">
    <table class="results-table">
      <tr [hidden]="!showName">
        <th colspan="2" style="text-align: center">{{ data.examName }}</th>
      </tr>
      <tr *ngIf="isOneStep">
        <td>Задача</td>
        <td>{{ data.stepResults[0].name }}</td>
      </tr>
      <tr *ngIf="isOneStep">
        <td>Кількість спроб</td>
        <td>{{ data.stepResults[0].attemptsAmount }}</td>
      </tr>
      <tr *ngIf="isOneStep">
        <td>Кількість помилок</td>
        <td>{{ data.stepResults[0].mistakesAmount }}</td>
      </tr>
      <tr *ngIf="!isOneStep && !noSteps" class="steps">
        <td colspan="2" class="steps-cell">
          <table *ngFor="let step of data.stepResults">
            <tr>
              <td>Крок {{ step.sequence }}</td>
              <td>{{ step.name }}</td>
            </tr>
            <tr>
              <td>Кількість спроб</td>
              <td>{{ step.attemptsAmount }}</td>
            </tr>
            <tr>
              <td>Кількість помилок</td>
              <td>{{ step.mistakesAmount }}</td>
            </tr>
          </table>
        </td>
      </tr>
      <tr>
        <td>Група</td>
        <td>{{ data.studentGroupName }}</td>
      </tr>
      <tr>
        <td>Студент</td>
        <td>{{ data.studentName }}</td>
      </tr>
      <tr>
        <td>Час роботи</td>
        <td>{{ duration }}</td>
      </tr>
      <tr class="score">
        <td>Оцінка</td>
        <td>{{ data.score }}{{ data.maxScore > 0 ? '/' + data.maxScore : '' }}</td>
      </tr>
    </table>
  </div>
  <div *ngFor="let stepInfo of stepInfos">

    <div *ngIf="stepInfo.type === InfoTypes.taskFlow && showTaskDetails"
         style="display: flex; flex-direction: column" class="mui-panel">
      <div>
        <task [problemConf]="stepInfo.data.variant.problemConf"
              [problemVariantConf]="stepInfo.data.variant.problemVariantConf"
              [hideControls]="true"></task>
      </div>
      <div *ngFor="let tfStep of stepInfo.data.data">
        <div [ngSwitch]="tfStep.stepType" class="task-data">
          <div *ngSwitchCase="TaskFlowStepTypes.DynamicTable">
            <h3>{{tfStep.name}}</h3>
            <dynamic-table [data]="tfStep.data"></dynamic-table>
          </div>
          <div *ngSwitchCase="TaskFlowStepTypes.Drawing"
               class="flex-container flex-column flex-align-center flex-justify-center">
            <h3>{{tfStep.name}}</h3>
            <geogebra [objects]="tfStep.data.geogebraObjects"
                      [settings]="tfStep.data.geogebraComponentSettings"></geogebra>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="stepInfo.type === InfoTypes.testSet && showTestDetails" class="mui-panel">
      <div class="header2 mui--text-center">Крок № {{ stepInfo.sequence }} - {{ stepInfo.name }}</div>
      <table class="mui-table mui-table--bordered">
        <thead>
        <tr>
          <th>Запитання тесту</th>
          <th style="width: 50px">К-сть помилок</th>
          <th style="width: 50px">Пройдено</th>
        </tr>
        </thead>
        <tbody>
        <ng-container *ngFor="let tst of stepInfo.data.testSetTests">
          <tr *ngIf="tst.isFakeToDisplayAttempt" class="mui--text-center header3 resmat-background-primary">
            <td colspan="3">Спроба {{ tst.id }}</td>
          </tr>
          <tr *ngIf="!tst.isFakeToDisplayAttempt">
            <td>
              <span [hidden]="!tst.testConfSnapshot.question">{{ tst.testConfSnapshot.question }}</span>
              <img *ngIf="tst.imageUrl" [src]="tst.imageUrl" style="max-height: 300px;">
            </td>
            <td [class.resmat-error]="tst.mistakes > 0">{{ tst.mistakes }}</td>
            <td [class.resmat-error]="!tst.done" [class.resmat-success]="tst.done">{{ tst.done ? 'Так'  : 'Ні' }}</td>
          </tr>
        </ng-container>
        <tr [hidden]="stepInfo.data.testSetTests && stepInfo.data.testSetTests.length" class="mui--text-center">
          Немає результатів для відображення
        </tr>
        </tbody>
      </table>
    </div>

  </div>
</div>
